<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
        <title>endeavor [at] rainbowsandpwnies.com - ctf-writeup</title>
        <link rel="stylesheet" href="http://tfpwn.rainbowsandpwnies.com/theme/css/main.css">
        <link href="http://tfpwn.rainbowsandpwnies.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="endeavor [at] rainbowsandpwnies.com Atom Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://tfpwn.rainbowsandpwnies.com/">endeavor [at] rainbowsandpwnies.com </a></h1>
                <nav><ul>
                    <li><a href="http://tfpwn.rainbowsandpwnies.com/pages/about.html">about</a></li>
                    <li><a href="http://tfpwn.rainbowsandpwnies.com/category/blog.html">blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://tfpwn.rainbowsandpwnies.com/re101.html">RE101</a></h1>
<footer class="post-info">
        <abbr class="published" title="2013-08-23T18:08:00">
                Fri 23 August 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://tfpwn.rainbowsandpwnies.com/author/endeavor.html">endeavor</a>
        </address>
<p>In <a href="http://tfpwn.rainbowsandpwnies.com/category/blog.html">blog</a>. </p>
<p>tags: <a href="http://tfpwn.rainbowsandpwnies.com/tag/ctf-writeup.html">ctf-writeup</a></p>
</footer><!-- /.post-info --><p>This write-up is for the &quot;re101&quot; challenge in the 2013 Bits for Everyone CTF, the qualifier for cadets at the United States Military Academy to join their competitive hacking team, C3T. I wrote this challenge for the CTF. This write up explains how I put this challenge together. This challenge would fall under the category, &quot;Reversing,&quot; or, &quot;Crackme.&quot;</p>
<p>This challenge is written in <a class="reference external" href="http://github.com/endeav0r/hsvm/">hsvm</a> assembly, and you will need hsvm to run this challenge. I actually had to write a new assembler for hsvm in python to put this challenge together. Complete source for this assembler is included at the end of this post.</p>
<p>For reference purposes the binary is available <a class="reference external" href="http://tfpwn.rainbowsandpwnies.com/files/re101.bin">here</a>. You should be able to follow along without the binary as we'll be talking mostly about how I put the binary together.</p>
<p>This challenge revolves around what I named the <tt class="docutils literal">CheckerFunction</tt>. There are actually 511 versions of <tt class="docutils literal">CheckerFunction</tt>, 511 <tt class="docutils literal">CheckerFail</tt> functions and 1 <tt class="docutils literal">CheckerSuccess</tt>. This is a total 2^10-1 functions, or two functions for each of 10 bytes of input except for the first byte for which there is only one <tt class="docutils literal">CheckerFunction</tt>.</p>
<p>Each <tt class="docutils literal">CheckerFunction</tt> &quot;points&quot; to two other <tt class="docutils literal">CheckerFunction</tt>. Each <tt class="docutils literal">CheckerFunction</tt> will receive one byte of input, add it to a buffer, and then jump to the next <tt class="docutils literal">CheckerFunction</tt> based on the least-significant-bit of that one byte of input.</p>
<p>To make things a little more interesting, every <tt class="docutils literal">CheckerFunction</tt> is <tt class="docutils literal">xor</tt> encrypted, with a random byte, which is embedded at assemble-time in its parent <tt class="docutils literal">CheckerFunction</tt>, which is of course also <tt class="docutils literal">xor</tt> encrypted, all the way up to the <tt class="docutils literal">entry</tt> function.</p>
<p>This means that for the 10 bytes of input exactly 10 of the 1023 <tt class="docutils literal">CheckerFunction</tt> will be decrypted and run. For 1023 of 1024 possible least significant bits, the program will appear to just read in bytes and print &quot;NO&quot; with all other functionality still encrypted. The reverser will most likely need to programmatically instrument the program to discovery all code paths.</p>
<p>Let's start looking at some of the actual assembly with the entry block:</p>
<div class="highlight"><pre>; we will store input bytes in a buffer at 0xffc0
mov r7, 0xffc0

mov r0, FirstCheckerFunctionAddress
mov r1, FirstCheckerFunctionSize
mov r2, FirstCheckerFunctionKey

jmp xor_jmp
</pre></div>
<p>We'll next introduce the xor_jmp function:</p>
<div class="highlight"><pre>; &quot;decrypts&quot; xor encrypted function and jumps to it
; @param r0 address of function
; @param r1 size of function
; @param r2 xor key

mov   r4, r0
XOR_JMP_LOOP:
loadb r3, r0
xor   r3, r3, r2
storb r0, r3
add   r0, 1
sub   r1, 1
cmp   r1, 0
jne   XOR_JMP_LOOP
mov   rip, r4
</pre></div>
<p>It's time to start getting into the <tt class="docutils literal">CheckerFunction</tt>.</p>
<div class="highlight"><pre>; r4 receives one byte of input
in r4

; r7 points to a buffer where we store input
storb r7, r4
add   r7, 1

; FUNCTION_SIZE is determined at assemble time to be the greater size of FUNC0 and FUNC1
mov r1, FUNCTION_SIZE

; r0 receives the address of the next CheckerFunction if the least significant bit of input is 0
mov r0, FUNC0_LABEL

; r2 receives the XOR byte to decrept FUNC0
mov r2, FUNC0_XORBYTE

; check LSB of input
and r4, 1
cmp r4, 0

; jump straight to xor_jmp if LSB is 0
je 0x8

; otherwise we set parameters for LSB=1
mov r0, FUNC1_LABEL
mov r2, FUNC1_XORBYTE

; xor_jmp will decrypt the next CheckerFunction and jump to it
jmp xor_jmp
</pre></div>
<p>I ran into a size problem while creating this challenge. HSVM has only has 64kb of addressable memory and I was coming in a little fat. <tt class="docutils literal">CheckerFunction</tt> is written to be reasonably small. At assemble time the greatest size of the two following functions will be determined and sent to xor_jmp. There is only instance where sizes will differ, and this is when of the following <tt class="docutils literal">CheckerFunction</tt> is actually <tt class="docutils literal">CheckerSuccess</tt>. Because both <tt class="docutils literal">CheckerFail</tt> and <tt class="docutils literal">CheckerSuccess</tt> will cause program termination and have no successor functions, the corruption on <tt class="docutils literal">xor</tt> decryption past the last <tt class="docutils literal">CheckerFail</tt> doesn't matter.</p>
<p>The <tt class="docutils literal">CheckerFunction</tt> functions are recursively generated. Here is some abbreviated python code to explain the process:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">CheckerFunction</span> <span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">MAX_DEPTH</span> <span class="p">:</span>
        <span class="n">func0</span> <span class="o">=</span> <span class="n">CheckerFunction</span><span class="p">(</span><span class="n">bits</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">func1</span> <span class="o">=</span> <span class="n">CheckerFunction</span><span class="p">(</span><span class="n">bits</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">gen_checker_function_name</span><span class="p">())</span>
        <span class="c"># f += get and store one byte of input</span>
        <span class="c"># f += set number of bytes to decrypt</span>
        <span class="c"># f += set next decryption function based on LSB</span>
        <span class="c"># f += decrypt and jump to next function</span>

        <span class="k">return</span> <span class="n">f</span>

    <span class="k">else</span> <span class="p">:</span>
        <span class="n">correct_bits</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">bits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">flag_bits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">correct_bits</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">correct_bits</span> <span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">gen_checker_function_name</span><span class="p">())</span>

            <span class="c">#f = Check to make sure input was correct</span>

            <span class="k">return</span> <span class="n">f</span>

        <span class="k">else</span> <span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">gen_checker_function_name</span><span class="p">())</span>

            <span class="c">#f = print NO</span>

            <span class="k">return</span> <span class="n">f</span>
</pre></div>
<p>This should be enough understanding to put together the rest of the code used to generate this challenge. Here are the two files you'll need:</p>
<div class="highlight"><pre><span class="c"># hsvmassembler.py</span>

<span class="k">class</span> <span class="nc">Register</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Label</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">def</span> <span class="nf">resolve</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;label &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; is -1&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">def</span> <span class="nf">relative</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;label &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; is -1&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">address</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span>

<span class="n">r0</span>  <span class="o">=</span> <span class="n">Register</span><span class="p">(</span><span class="s">&#39;r0&#39;</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span>
<span class="n">r1</span>  <span class="o">=</span> <span class="n">Register</span><span class="p">(</span><span class="s">&#39;r1&#39;</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)</span>
<span class="n">r2</span>  <span class="o">=</span> <span class="n">Register</span><span class="p">(</span><span class="s">&#39;r2&#39;</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">)</span>
<span class="n">r3</span>  <span class="o">=</span> <span class="n">Register</span><span class="p">(</span><span class="s">&#39;r3&#39;</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">)</span>
<span class="n">r4</span>  <span class="o">=</span> <span class="n">Register</span><span class="p">(</span><span class="s">&#39;r4&#39;</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">)</span>
<span class="n">r5</span>  <span class="o">=</span> <span class="n">Register</span><span class="p">(</span><span class="s">&#39;r5&#39;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">)</span>
<span class="n">r6</span>  <span class="o">=</span> <span class="n">Register</span><span class="p">(</span><span class="s">&#39;r6&#39;</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">)</span>
<span class="n">r7</span>  <span class="o">=</span> <span class="n">Register</span><span class="p">(</span><span class="s">&#39;r7&#39;</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">)</span>
<span class="n">rbp</span> <span class="o">=</span> <span class="n">Register</span><span class="p">(</span><span class="s">&#39;rbp&#39;</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">)</span>
<span class="n">rsp</span> <span class="o">=</span> <span class="n">Register</span><span class="p">(</span><span class="s">&#39;rsp&#39;</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">)</span>
<span class="n">rip</span> <span class="o">=</span> <span class="n">Register</span><span class="p">(</span><span class="s">&#39;rip&#39;</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">imm</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">return</span> <span class="nb">chr</span><span class="p">((</span><span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">n</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Instruction</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">mnemonic</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="n">op</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="n">mnemonic</span>
    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">)))</span>
    <span class="k">def</span> <span class="nf">__str__</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="n">mnemonic</span>


<span class="k">class</span> <span class="nc">Arith</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lhs</span>  <span class="o">=</span> <span class="n">lhs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span>  <span class="o">=</span> <span class="n">rhs</span>

    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">bytes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">]</span>
        <span class="nb">bytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">asm</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span> <span class="p">:</span>
            <span class="nb">bytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">asm</span><span class="p">())</span>
            <span class="nb">bytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">asm</span><span class="p">())</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="p">,</span> <span class="n">Label</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">bytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">resolve</span><span class="p">()))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="nb">bytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">rhs</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Add</span> <span class="p">(</span><span class="n">Arith</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Arith</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rhs</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x10</span><span class="s">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x11</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;add&#39;</span>

<span class="k">class</span> <span class="nc">Sub</span> <span class="p">(</span><span class="n">Arith</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Arith</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rhs</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x12</span><span class="s">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x13</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;sub&#39;</span>

<span class="k">class</span> <span class="nc">Mul</span> <span class="p">(</span><span class="n">Arith</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Arith</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rhs</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x14</span><span class="s">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x15</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;mul&#39;</span>

<span class="k">class</span> <span class="nc">Div</span> <span class="p">(</span><span class="n">Arith</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Arith</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rhs</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x16</span><span class="s">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x17</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;div&#39;</span>

<span class="k">class</span> <span class="nc">Mod</span> <span class="p">(</span><span class="n">Arith</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Arith</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rhs</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x18</span><span class="s">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x19</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;mod&#39;</span>

<span class="k">class</span> <span class="nc">And</span> <span class="p">(</span><span class="n">Arith</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Arith</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rhs</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x1A</span><span class="s">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x1B</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;and&#39;</span>

<span class="k">class</span> <span class="nc">Or</span> <span class="p">(</span><span class="n">Arith</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Arith</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rhs</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x1C</span><span class="s">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x1D</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;or&#39;</span>

<span class="k">class</span> <span class="nc">Xor</span> <span class="p">(</span><span class="n">Arith</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Arith</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rhs</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x1E</span><span class="s">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x1F</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;xor&#39;</span>


<span class="k">class</span> <span class="nc">Cmp</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lhs</span> <span class="o">=</span> <span class="n">lhs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span> <span class="o">=</span> <span class="n">rhs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;cmp&#39;</span>

    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span> <span class="n">Register</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x53</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span> <span class="n">Label</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x54</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x54</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CondJmp</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imm</span> <span class="o">=</span> <span class="n">imm</span>

    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imm</span><span class="p">,</span> <span class="n">Label</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imm</span><span class="o">.</span><span class="n">relative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imm</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Je</span> <span class="p">(</span><span class="n">CondJmp</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">CondJmp</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x21</span><span class="s">&#39;</span>

<span class="k">class</span> <span class="nc">Jne</span> <span class="p">(</span><span class="n">CondJmp</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">CondJmp</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x22</span><span class="s">&#39;</span>

<span class="k">class</span> <span class="nc">Jl</span> <span class="p">(</span><span class="n">CondJmp</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">CondJmp</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x23</span><span class="s">&#39;</span>

<span class="k">class</span> <span class="nc">Jle</span> <span class="p">(</span><span class="n">CondJmp</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">CondJmp</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x24</span><span class="s">&#39;</span>

<span class="k">class</span> <span class="nc">Jg</span> <span class="p">(</span><span class="n">CondJmp</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">CondJmp</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x25</span><span class="s">&#39;</span>

<span class="k">class</span> <span class="nc">Jge</span> <span class="p">(</span><span class="n">CondJmp</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">CondJmp</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x26</span><span class="s">&#39;</span>


<span class="k">class</span> <span class="nc">Call</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span>
    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">Register</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x28</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">Label</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x27\x00</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">relative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x27\x00</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Jmp</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span>
    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">Label</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x20\x00</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">relative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x20\x00</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Ret</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x29</span><span class="s">&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">LoadOp</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src</span>  <span class="o">=</span> <span class="n">src</span>
    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">,</span> <span class="n">Register</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">,</span> <span class="n">Label</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Load</span> <span class="p">(</span><span class="n">LoadOp</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">LoadOp</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">Register</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x31</span><span class="s">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x30</span><span class="s">&#39;</span>

<span class="k">class</span> <span class="nc">Loadb</span> <span class="p">(</span><span class="n">LoadOp</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">LoadOp</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">Register</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x33</span><span class="s">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x32</span><span class="s">&#39;</span>

<span class="k">class</span> <span class="nc">StorOp</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src</span>  <span class="o">=</span> <span class="n">src</span>
    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">Register</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">Label</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Stor</span> <span class="p">(</span><span class="n">StorOp</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">StorOp</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">Register</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x35</span><span class="s">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x34</span><span class="s">&#39;</span>

<span class="k">class</span> <span class="nc">Storb</span> <span class="p">(</span><span class="n">StorOp</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">StorOp</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">Register</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x37</span><span class="s">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x36</span><span class="s">&#39;</span>


<span class="k">class</span> <span class="nc">Push</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="n">src</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">Register</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x42</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">Label</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x43\x00</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x43\x00</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Pop</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span>
    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x44</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">&#39;</span>


<span class="k">class</span> <span class="nc">In</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span>
    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x40</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">&#39;</span>

<span class="k">class</span> <span class="nc">Out</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">=</span> <span class="n">src</span>
    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x41</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">&#39;</span>


<span class="k">class</span> <span class="nc">Mov</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">=</span> <span class="n">src</span>
    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">,</span> <span class="n">Register</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x51</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">,</span> <span class="n">Label</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x52</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\x52</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span> <span class="o">+</span> <span class="n">imm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Hlt</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x60</span><span class="s">&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Nop</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x90</span><span class="s">&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Syscall</span> <span class="p">(</span><span class="n">Instruction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
<span class="n">Instruction</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x61</span><span class="s">&#39;</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">hsvmassembler</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">FLAG</span> <span class="o">=</span> <span class="s">&#39;FLAGHERE12&#39;</span>
<span class="n">MAX_DEPTH</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">FLAG</span><span class="p">)</span>
<span class="n">GEN_FUNCTION_I</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">STR_NO_ADDR</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">STR_YES_ADDR</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">R7_INPUT_ADDR</span> <span class="o">=</span> <span class="mh">0xffc0</span>

<span class="n">flag_bits</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">FLAG</span> <span class="p">:</span>
    <span class="n">flag_bits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;flag_bits&#39;</span><span class="p">,</span> <span class="n">flag_bits</span>

<span class="k">class</span> <span class="nc">Function</span> <span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xorbyte</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_address</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="p">:</span>
            <span class="n">label</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">address</span> <span class="o">+</span> <span class="n">label</span><span class="o">.</span><span class="n">offset</span>

    <span class="k">def</span> <span class="nf">asm</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">instruction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span> <span class="p">:</span>
            <span class="n">instruction</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">instruction</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span>
            <span class="n">address</span> <span class="o">+=</span> <span class="mi">4</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">asmxor</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span>
        <span class="n">xorbytes</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">bytes</span> <span class="p">:</span>
            <span class="n">xorbytes</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">^</span> <span class="bp">self</span><span class="o">.</span><span class="n">xorbyte</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xorbytes</span>

    <span class="k">def</span> <span class="nf">ins</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ins</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ins</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">size</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gen_label</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">label</span>



<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    xor_jmp</span>
<span class="sd">    r0 = address of function</span>
<span class="sd">    r1 = size of function</span>
<span class="sd">    r2 = xor key</span>
<span class="sd">    killed: r0, r1, r2, r3, r4</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">xor_jmp</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;xor_jmp&#39;</span><span class="p">)</span>
<span class="n">xor_jmp</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span>  <span class="p">(</span><span class="n">r4</span><span class="p">,</span> <span class="n">r0</span><span class="p">))</span>
<span class="n">xor_jmp_loop</span> <span class="o">=</span> <span class="n">xor_jmp</span><span class="o">.</span><span class="n">gen_label</span><span class="p">(</span><span class="s">&#39;xor_jmp_loop&#39;</span><span class="p">)</span>
<span class="n">xor_jmp</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Loadb</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="n">r0</span><span class="p">))</span>
<span class="n">xor_jmp</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Xor</span>  <span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="n">r3</span><span class="p">,</span> <span class="n">r2</span><span class="p">))</span>
<span class="n">xor_jmp</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Storb</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">r3</span><span class="p">))</span>
<span class="n">xor_jmp</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Add</span>  <span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">xor_jmp</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Sub</span>  <span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">xor_jmp</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Cmp</span>  <span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">xor_jmp</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Jne</span>  <span class="p">(</span><span class="n">xor_jmp_loop</span><span class="p">))</span>
<span class="n">xor_jmp</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span>  <span class="p">(</span><span class="n">rip</span><span class="p">,</span> <span class="n">r4</span><span class="p">))</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    str_out</span>
<span class="sd">    r0 = address of string</span>
<span class="sd">    killed: r0, r1</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">str_out</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;str_out&#39;</span><span class="p">)</span>
<span class="n">str_out</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Loadb</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r0</span><span class="p">))</span>
<span class="n">str_out_loop</span> <span class="o">=</span> <span class="n">str_out</span><span class="o">.</span><span class="n">gen_label</span><span class="p">(</span><span class="s">&#39;str_out_loop&#39;</span><span class="p">)</span>
<span class="n">str_out</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Out</span><span class="p">(</span><span class="n">r1</span><span class="p">))</span>
<span class="n">str_out</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Add</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">str_out</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Loadb</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r0</span><span class="p">))</span>
<span class="n">str_out</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Cmp</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">str_out</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Jne</span><span class="p">(</span><span class="n">str_out</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
<span class="n">str_out</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Ret</span><span class="p">())</span>



<span class="k">def</span> <span class="nf">gen_checker_function_name</span> <span class="p">()</span> <span class="p">:</span>
    <span class="k">global</span> <span class="n">GEN_FUNCTION_I</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;checker_function_&#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">GEN_FUNCTION_I</span><span class="p">)</span>
    <span class="n">GEN_FUNCTION_I</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">name</span>

<span class="k">def</span> <span class="nf">CheckerFunction</span> <span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">MAX_DEPTH</span> <span class="p">:</span>
        <span class="n">func0</span> <span class="o">=</span> <span class="n">CheckerFunction</span><span class="p">(</span><span class="n">bits</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">func1</span> <span class="o">=</span> <span class="n">CheckerFunction</span><span class="p">(</span><span class="n">bits</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">gen_checker_function_name</span><span class="p">())</span>
        <span class="c"># get 1 byte of input</span>
        <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">In</span><span class="p">(</span><span class="n">r4</span><span class="p">))</span>                 <span class="c"># 1</span>
        <span class="c"># store input byte</span>
        <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Storb</span><span class="p">(</span><span class="n">r7</span><span class="p">,</span> <span class="n">r4</span><span class="p">))</span>          <span class="c"># 2</span>
        <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Add</span><span class="p">(</span><span class="n">r7</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>             <span class="c"># 3</span>
        <span class="c"># either the functions to decrypt will be the same size</span>
        <span class="c"># or they will be final, so pick the biggest size and</span>
        <span class="c"># decrypt that size</span>
        <span class="k">if</span> <span class="n">func0</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">func1</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">func0</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">func1</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span>
        <span class="c"># check LSB</span>
        <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">func0</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>   <span class="c"># 7</span>
        <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">func0</span><span class="o">.</span><span class="n">xorbyte</span><span class="p">))</span> <span class="c"># 9</span>
        <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">And</span><span class="p">(</span><span class="n">r4</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>             <span class="c"># 4</span>
        <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Cmp</span><span class="p">(</span><span class="n">r4</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>             <span class="c"># 5</span>
        <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Je</span><span class="p">(</span><span class="mh">0x8</span><span class="p">))</span>                 <span class="c"># 6</span>
        <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">func1</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>   <span class="c"># 11</span>
        <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">func1</span><span class="o">.</span><span class="n">xorbyte</span><span class="p">))</span> <span class="c"># 13</span>
        <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Jmp</span><span class="p">(</span><span class="n">xor_jmp</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>     <span class="c"># 14</span>

        <span class="n">f</span><span class="o">.</span><span class="n">func0</span> <span class="o">=</span> <span class="n">func0</span>
        <span class="n">f</span><span class="o">.</span><span class="n">func1</span> <span class="o">=</span> <span class="n">func1</span>

        <span class="k">return</span> <span class="n">f</span>

    <span class="k">else</span> <span class="p">:</span>
        <span class="n">correct_bits</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">bits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">flag_bits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">correct_bits</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">correct_bits</span> <span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;correct_bits&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">gen_checker_function_name</span><span class="p">())</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r7</span><span class="p">,</span> <span class="n">R7_INPUT_ADDR</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r6</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Jmp</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
            <span class="n">die_label</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">gen_label</span><span class="p">(</span><span class="s">&#39;correct_die&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">STR_NO_ADDR</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Call</span><span class="p">(</span><span class="n">str_out</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Hlt</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">flag_char</span> <span class="ow">in</span> <span class="n">FLAG</span> <span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="nb">ord</span><span class="p">(</span><span class="n">flag_char</span><span class="p">)))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Loadb</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r7</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Cmp</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">r1</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Jne</span><span class="p">(</span><span class="n">die_label</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Add</span><span class="p">(</span><span class="n">r7</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">STR_YES_ADDR</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Call</span><span class="p">(</span><span class="n">str_out</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Hlt</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">f</span>

        <span class="k">else</span> <span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">gen_checker_function_name</span><span class="p">())</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">STR_NO_ADDR</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Call</span><span class="p">(</span><span class="n">str_out</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Hlt</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">f</span>


<span class="c"># Generate checker functions</span>
<span class="n">checkerFunctions</span> <span class="o">=</span> <span class="n">CheckerFunction</span><span class="p">([])</span>

<span class="c"># create entry function</span>
<span class="n">entry</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;entry&#39;</span><span class="p">)</span>
<span class="n">entry</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r7</span><span class="p">,</span> <span class="n">R7_INPUT_ADDR</span><span class="p">))</span>
<span class="n">entry</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">checkerFunctions</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
<span class="n">entry</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">checkerFunctions</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span>
<span class="n">entry</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Mov</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">checkerFunctions</span><span class="o">.</span><span class="n">xorbyte</span><span class="p">))</span>
<span class="n">entry</span><span class="o">.</span><span class="n">ins</span><span class="p">(</span><span class="n">Jmp</span><span class="p">(</span><span class="n">xor_jmp</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>

<span class="c"># set address for static functions</span>
<span class="n">entry</span><span class="o">.</span><span class="n">set_address</span><span class="p">(</span><span class="mh">0x10</span><span class="p">)</span>
<span class="n">xor_jmp</span><span class="o">.</span><span class="n">set_address</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
<span class="n">str_out</span><span class="o">.</span><span class="n">set_address</span><span class="p">(</span><span class="n">xor_jmp</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="n">xor_jmp</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>

<span class="c"># set checker function addresses</span>
<span class="n">CFAddr</span> <span class="o">=</span> <span class="n">str_out</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="n">str_out</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">setCFAddress</span> <span class="p">(</span><span class="n">checkerFunction</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">global</span> <span class="n">CFAddr</span>
    <span class="n">checkerFunction</span><span class="o">.</span><span class="n">set_address</span><span class="p">(</span><span class="n">CFAddr</span><span class="p">)</span>
    <span class="k">print</span> <span class="nb">hex</span><span class="p">(</span><span class="n">checkerFunction</span><span class="o">.</span><span class="n">address</span><span class="p">),</span> <span class="nb">hex</span><span class="p">(</span><span class="n">checkerFunction</span><span class="o">.</span><span class="n">xorbyte</span><span class="p">)</span>
    <span class="n">CFAddr</span> <span class="o">+=</span> <span class="n">checkerFunction</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">checkerFunction</span><span class="p">,</span> <span class="s">&#39;func0&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">setCFAddress</span><span class="p">(</span><span class="n">checkerFunction</span><span class="o">.</span><span class="n">func0</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">checkerFunction</span><span class="p">,</span> <span class="s">&#39;func1&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">setCFAddress</span><span class="p">(</span><span class="n">checkerFunction</span><span class="o">.</span><span class="n">func1</span><span class="p">)</span>
<span class="n">setCFAddress</span><span class="p">(</span><span class="n">checkerFunctions</span><span class="p">)</span>


<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    0000  = JMP to entry</span>
<span class="sd">    0004  = NO\x00\x00</span>
<span class="sd">    0008  = YES\x00</span>
<span class="sd">    0010  = ENTRY FUNCTION</span>
<span class="sd">    ????  = xor_jmp</span>
<span class="sd">    ????  = str_out</span>
<span class="sd">    ???? = checker_functions</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="c"># set up up binary</span>
<span class="nb">bytes</span>  <span class="o">=</span> <span class="n">Jmp</span><span class="p">(</span><span class="mh">0xc</span><span class="p">)</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span>
<span class="nb">bytes</span> <span class="o">+=</span> <span class="s">&#39;NO</span><span class="se">\x00\x00</span><span class="s">&#39;</span>
<span class="nb">bytes</span> <span class="o">+=</span> <span class="s">&#39;YES</span><span class="se">\x00</span><span class="s">&#39;</span>
<span class="nb">bytes</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s">&#39;</span>
<span class="nb">bytes</span> <span class="o">+=</span> <span class="n">entry</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span>
<span class="nb">bytes</span> <span class="o">+=</span> <span class="n">xor_jmp</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span>
<span class="nb">bytes</span> <span class="o">+=</span> <span class="n">str_out</span><span class="o">.</span><span class="n">asm</span><span class="p">()</span>

<span class="c"># get xor bytes for checker functions</span>
<span class="k">def</span> <span class="nf">asmxor_checkerFunctions</span> <span class="p">(</span><span class="n">checkerFunction</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">checkerFunction</span><span class="o">.</span><span class="n">asmxor</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">checkerFunction</span><span class="p">,</span> <span class="s">&#39;func0&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">asmxor_checkerFunctions</span><span class="p">(</span><span class="n">checkerFunction</span><span class="o">.</span><span class="n">func0</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">checkerFunction</span><span class="p">,</span> <span class="s">&#39;func1&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">asmxor_checkerFunctions</span><span class="p">(</span><span class="n">checkerFunction</span><span class="o">.</span><span class="n">func1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="nb">bytes</span> <span class="o">+=</span> <span class="n">asmxor_checkerFunctions</span><span class="p">(</span><span class="n">checkerFunctions</span><span class="p">)</span>

<span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;re101.bin&#39;</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
<span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
<span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://github.com/endeav0r">github</a></li>
                            <li><a href="http://www.linkedin.com/in/alexeubanks/">linkedin</a></li>
                            <li><a href="http://twitter.com/rednovae">twitter</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://tfpwn.rainbowsandpwnies.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>